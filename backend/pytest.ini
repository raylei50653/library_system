# backend/pytest.ini
[pytest]
# 讓 pytest-django 找到設定模組
DJANGO_SETTINGS_MODULE = config.settings_test

# 測試檔命名規則（三種慣例都會被發現）
python_files = tests.py test_*.py *_tests.py

# 測試搜尋範圍（加快收集；依你的專案結構調整）
testpaths =
    users
    books
    loans
    auth_app
    chat
    favorites
    notifications

# 預設參數：安靜輸出、重用測試資料庫、嚴格標記、顯示所有摘要
addopts =
    -q
    --reuse-db
    --strict-markers
    --randomly-seed=42

# 自訂標記，避免 PytestUnknownMarkWarning
markers =
    unit: 單元測試（serializers / services / permissions）
    api: API 測試（DRF endpoints）
    slow: 較慢的整合/流程情境測試
    service: 服務層測試
    permission: 權限相關測試

# 日誌直接在終端顯示（對 API 失敗除錯很有用）
log_cli = true
log_cli_level = INFO

# 警告處理：暫時忽略 Django 6.0 對 CheckConstraint 的參數更名警告
filterwarnings =
    ignore:CheckConstraint\.check is deprecated in favor of `\.condition`.:django.utils.deprecation.RemovedInDjango60Warning
